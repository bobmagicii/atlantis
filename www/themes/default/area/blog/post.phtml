<?php

/**
 * @var Routes\Blog\Post $Route
 * @var Atlantis\Prototype\Blog $Blog
 * @var Atlantis\Prototype\BlogPost $Post
*/

echo (new Atlantis\Element\PagePromo)
->SetURL($Blog->URL)
->SetImageURL($Blog->ImageHeaderURL)
->SetIconURL($Blog->ImageIconURL)
->SetTitle($Blog->Title)
->SetSubtitle($Blog->Tagline ?: '');

?>

<div class="container">

	<div class="row">
		<?php if($Post->IsAdult()): ?>
		<div class="col-12 mb-4">
			<div class="alert alert-adult">
				<i class="fa fas fa-exclamation-square mr-2"></i>
				This post contains Adult Content.
			</div>
		</div>
		<?php endif; ?>

		<div class="col-12 col-md-8 mb-4">
			<div class="PostListing">
				<div class="Post">
					<h3><a href="<?php $Printer($Post->GetURL()) ?>"><?php $Printer($Post->Title) ?></a></h3>
					<div class="About">
						Posted on <a class="Date" href="<?php $Printer($Post->URL) ?>"><?php $Printer($Post->DateCreated->Format('F jS g:ia')) ?></a>
						From <a class="Source" href="<?php $Printer($Post->Blog->URL) ?>"><?php $Printer($Post->Blog->Title) ?></a>
						By <a class="Authour" href="<?php $Printer($Post->User->URL) ?>"><?php $Printer($Post->User->Alias) ?></a>
					</div>
				</div>
			</div>
			<div class="PostContent">

			<?php if($Route->ShouldAdultSafespace()): ?>
			<div class="alert alert-adult">
				<?php if($User): ?>
				<p>
					This post has been hidden because your account settings are currently configured to not display adult content.
					You may change the setting in your dashboard <a href="<?php echo $Endpoint('Atlantis.Dashboard.Account.Settings') ?>">Account Settings</a>.
				</p>
				<div class="text-center">
					<form method="post">
						<input type="hidden" name="Action" value="ignore-adult-safespace" />
						<button type="submit" class="btn btn-adult">View Post Anyway</button>
					</form>
				</div>
				<?php else: ?>
				This post has been hidden because you are not <a href="<?php echo $Endpoint('Atlantis.Login') ?>">logged in</a> and have opted-in to have adult content displayed.
				<?php endif; ?>
			</div>
			<?php else: ?>
			<?php echo $Post->Content, PHP_EOL ?>
			<?php endif; ?>

			</div>
		</div>
		<div class="col-12 col-md-4 mb-4">
			<?php
			if($PopularPosts->Total)
			echo (new Atlantis\Element\PostListingSidebar)
			->AddClasses('DefocusUntilHover','mb-8')
			->SetTitle('Popular Posts')
			->SetItemStore($PopularPosts->Payload);
			?>

			<?php
			echo (new Atlantis\Element\PostListingSidebar)
			->AddClasses('DefocusUntilHover')
			->SetTitle('Recent Posts')
			->SetItemStore($RecentPosts->Payload);
			?>
		</div>
	</div>

</div>
